/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @version 2.9.0
 *
 * Client actions for yii2-grid expand row
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2014, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){var t=0;kvExpandRow=function(a){var n=a.gridId,l=a.hiddenFromExport,d=a.detailUrl,o=a.onDetailLoaded,i=a.batchToggle,s=a.expandIcon,r=a.collapseIcon,c=a.expandTitle,v=a.collapseTitle,p=a.expandAllTitle,f=a.collapseAllTitle,u=l?a.rowCssClass+" skip-export":a.rowCssClass,k=a.animationDuration,x=jQuery("#"+n),g=x.find(".kv-expand-header-cell"),h=g.find(".kv-expand-header-icon"),w=void 0==a.collapseAll?!1:a.collapseAll,C=void 0==a.expandAll?!1:a.expandAll,m=x.find("td:visible .kv-expand-row:not(.kv-state-disabled)"),A=m.length,b="kv-expand-detail-loading",y=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},T=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},R=function(e,t){e.removeClass(t).addClass(t)},I=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},D=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},E=function(e){R(e,b)},$=function(e){var t=isNaN(k)?1e3:k+200;setTimeout(function(){e.removeClass(b)},t)};return 0==m.length?void R(g,"kv-state-disabled"):(m.each(function(){var a=e(this),n=a.find(".kv-expand-icon"),l=a.closest("tr"),p=a.closest(".kv-expand-icon-cell"),f=a.find(".kv-expand-detail"),m=a.find(".kv-expanded-row"),R=m.data("key"),j=m.data("index"),F=l.find("td:visible").length;if(!y(n)&&!T(n))return!0;0==m.length&&(R=l.data("key"),$newRow=l.next('tr.kv-expand-detail-row[data-key="'+R+'"]'),m=$newRow.find(".kv-expanded-row"));var L=function(t){return E(p),d.length>0&&0==m.html().length?(x.trigger("kvexprow.beforeLoad",[j,R]),void m.load(d,{expandRowKey:R,expandRowInd:j},function(){$(p),o&&e.isFunction(o)&&o(),t(),x.trigger("kvexprow.loaded",[j,R])})):void t()},N=function(e){x.find('tr[data-index="'+j+'"]').remove(),m.hide(),l.after(m);var t='<tr class="kv-expand-detail-row '+u+'" data-key="'+R+'" data-index="'+j+'">';m.wrap('<td colspan="'+F+'">').parent().wrap(t),n.html(r),p.attr("title",v),e?m.slideDown(k,function(){D(n)}):(m.show(),D(n)),0==d.length&&$(p)},Q=function(){E(p),f.html(""),n.html(s),p.attr("title",c),$tr=m.closest(".kv-expand-detail-row"),m.slideUp(k,function(){m.unwrap().unwrap(),m.appendTo(f),I(n)}),$(p)};return C&&i?(T(n)&&L(function(){N(!0),t++,t>=A&&($(g),h.focus())}),t>=A&&($(g),h.focus()),!0):w&&i?(y(n)&&(Q(),t++,t>=A&&($(g),h.focus())),t>=A&&($(g),h.focus()),!0):(y(n)&&N(!1),void p.off().on("click",function(){return p.hasClass(b)?void 0:T(n)?(L(function(){N(!0)}),x.trigger("kvexprow.toggle",[j,R,!0]),void n.focus()):void(y(n)&&(Q(),x.trigger("kvexprow.toggle",[j,R,!1]),n.focus()))}))}),void(i&&g.off().on("click",function(){if(!g.hasClass(b)&&0!=m.length){var n=T(h),l=y(h),d=e.extend({},a,{expandAll:l,collapseAll:n});E(g),l?(t=m.find(".kv-state-collapsed").length,I(h),h.html(r),g.attr("title",f),x.trigger("kvexprow.toggleAll",[!1])):n&&(t=m.find(".kv-state-expanded").length,D(h),h.html(s),g.attr("title",p),x.trigger("kvexprow.toggleAll",[!0])),kvExpandRow(d)}})))}}(window.jQuery);